
jobs:
- job: win
  pool:
    vmImage: vs2017-win2016
  timeoutInMinutes: 360
  strategy:
    maxParallel: 4
    matrix:
      win_cxx_compilervs2015python3.7vc14:
        CONFIG: win_cxx_compilervs2015python3.7vc14
        CONDA_BLD_PATH: D:\\bld\\
        UPLOAD_PACKAGES: False
  steps:

    - powershell: Write-Host "##vso[task.prependpath]$env:CONDA\Scripts"
      displayName: Add conda to PATH

    - script: conda create --yes --quiet --name entwine
      displayName: Create conda environment

    - script: |
          call activate entwine
          conda install --yes --quiet --name entwine -c conda-forge pdal ninja
      displayName: Install conda packages

    - script: |
          call activate entwine
          call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC\Auxiliary\Build\vcvarsall.bat" x64
          cmake -Wno-dev -G "Ninja" ^
            -DCMAKE_INSTALL_PREFIX=D:/bld ^
            -DCMAKE_BUILD_TYPE=RelWithDebInfo ^
            -DBUILD_SHARED_LIBS=ON ^
            -Dgtest_force_shared_crt=ON .
      displayName: Configure CMake

    - script: |
          ninja
      displayName: Build
